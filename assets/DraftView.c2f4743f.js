import{f as Z,g as ee,h as te,i as ae,m as oe,j as le,r as ne,l as se,s as re,e as ie,d as p}from"./element-plus.8bd38160.js";import{u as ue}from"./vue-router.acfefc2e.js";import{_ as pe,u as de,r as w}from"./index.440ae04c.js";import{D as A}from"./Date.43b474cf.js";import{h as _,a0 as ce,aa as D,o as P,c as T,L as t,J as o,G as B,ac as fe,a as m,a2 as c,O as h,u as k,a7 as me}from"./@vue.2fe4fb4f.js";import"./@element-plus.6dbc46d1.js";import"./@vueuse.1809dbd0.js";import"./lodash-es.292de2a1.js";import"./@popperjs.36402333.js";import"./@ctrl.b082b0c1.js";import"./js-md5.959ac667.js";import"./@babel.53fad141.js";import"./@kangc.4df2a972.js";import"./vue.02683aef.js";import"./@vuepress.0f7d6c54.js";import"./highlight.js.a44cb2e8.js";import"./codemirror.9d7a24b7.js";import"./sakana-widget.26843129.js";const ge={class:"dialog-footer"},ve={style:{"font-weight":"bolder",color:"#666666","font-size":"x-large"}},_e=["src"],he={style:{height:"150px",width:"auto"}},ye={class:"introCard"},we={style:{color:"#777777","font-size":"small",bottom:"10px",position:"absolute",width:"55%"}},g="https://server.asgardion.space",De={__name:"DraftView",setup(xe){const x=_(!0),y=_(!1),r=de(),v=ue(),f=_(),S=_([]),b=_([]),V=_(parseInt(v.params.page||1));let N="https://source.unsplash.com/random/900x600/?desktop,wallparper";const a=_({id:"",authorUuid:r.$userInfo.value.id,topic:"",content:"",intro:"",assort:"",author:r.$userInfo.value.username,createDate:new Date,changeDate:new Date,tag:"",like:[],weight:0}),d=new Headers;d.append("Content-Type","application/json");async function F(l){let e={method:"GET",headers:d,redirect:"follow"};await fetch(`${g}/draft/${l}`,e).then(n=>n.json()).then(n=>{origin=n,a.value=n}),y.value=!0,x.value=!0}function C(l){S.value=me(b.value).slice(l*5-5,l*5),l!==1?w.push({name:"DraftPage",params:{page:l}}):w.push({name:"Draft"});let e;cancelAnimationFrame(e),e=requestAnimationFrame(function n(){let i=document.body.scrollTop||document.documentElement.scrollTop;i>0?(scrollTo(0,i-25),e=requestAnimationFrame(n)):cancelAnimationFrame(e)})}async function $(){let l={method:"GET",headers:d,redirect:"follow"};await fetch(`${g}/draft/`,l).then(e=>e.json()).then(e=>{b.value=[];for(let n in e)e[n].authorUuid===r.$userInfo.value.id&&b.value.push(e[n]);f.value=b.value.length}),typeof v.params.page<"u"?C(v.params.page):C(1)}function I(){let l={method:"PATCH",headers:d,redirect:"follow"};l.body=JSON.stringify(r.$userInfo.value),fetch(`${g}/users/${r.$userInfo.value.id}`,l)}async function j(){let l={method:"DELETE",headers:d,redirect:"follow"};const e=a.value;l.body=JSON.stringify(e),await fetch(`${g}/draft/${a.value.id}`,l).then(()=>{p({message:"\u7A3F\u7EB8\u5DF2\u88AB\u6298\u6210\u7EB8\u98DE\u673A\uFF5E",type:"success"}),r.$userInfo.value.draft--,x.value=!1,y.value=!1,f.value--,I()}).catch(n=>p({message:n,type:"error"})),f.value%5===0&&v.params.page>2&&await w.push({name:v.name,params:{page:v.params.page-1}}),f.value%5===0&&v.params.page===2&&await w.push({name:"Draft"}),await $()}async function H(){if(a.value.topic===""){p({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}a.value.intro===""&&(a.value.intro=a.value.content.substring(0,155));let l={method:"DELETE",headers:d,redirect:"follow"},e={method:"Post",headers:d,redirect:"follow"};if(a.value.id!==""){const i=a.value;l.body=JSON.stringify(i),await fetch(`${g}/draft/${a.value.id}`,l).then(()=>{r.$userInfo.value.draft--,f.value--}).catch(O=>p({message:O,type:"error"}))}const n=a.value;n.id="",n.assort="Default",n.createDate=n.changeDate=new Date,e.body=JSON.stringify(n),await fetch(`${g}/article`,e).then(()=>{r.$reloadHot.value=!r.$reloadHot.value,r.$userInfo.value.articles++,r.$allHas.value++,x.value=!1,y.value=!1,p({message:"\u7A3F\u7EB8\u6295\u9001\u6210\u529F\uFF5E",type:"success"})}).catch(i=>p({message:i,type:"error"})),I(),f.value%5===0&&location.replace(location.origin+"/#/draft"),await $()}async function U(){if(a.value.topic===""){p({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}if(a.value.assort===""&&(a.value.assort="Default"),a.value.intro===""&&(a.value.intro=a.value.content.substring(0,155)),a.value.id!==""){let l={method:"PATCH",headers:d,redirect:"follow"};const e=a.value;e.changeDate=new Date,l.body=JSON.stringify(e),await fetch(`${g}/draft/${a.value.id}`,l).then(()=>{p({message:"\u5DF2\u4FDD\u5B58\u5230\u8349\u7A3F\u7BB1\uFF01",type:"success"})}).catch(n=>alert(n))}else{let l={method:"POST",headers:d,redirect:"follow"};const e=a.value;e.createDate=e.changeDate=new Date,l.body=JSON.stringify(e),await fetch(`${g}/draft/`,l).then(()=>{p({message:"\u5DF2\u4FDD\u5B58\u5230\u8349\u7A3F\u7BB1\uFF01",type:"success"}),r.$userInfo.value.draft++,f.value++,I()}).catch(n=>p({message:n,type:"error"}))}await $()}function J(){(a.value.content!==""||a.value.topic!=="")&&x.value&&ie.confirm("\u5185\u5BB9\u672A\u4FDD\u5B58\uFF0C"+r.$userInfo.value.username+"\u771F\u7684\u8981\u8D70\u5417\uFF1F","Warning",{confirmButtonText:"\u72E0\u5FC3\u79BB\u5F00",cancelButtonText:"\u4FDD\u5B58\u5E76\u79BB\u5F00",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).catch(()=>{U()})}function z(){w.push({name:"Main"})}ce(()=>{$()});function G(l){return N+","+l+")"}return(l,e)=>{const n=Z,i=ee,O=D("v-md-editor"),q=te,M=ae,u=oe,L=le,R=D("User"),E=ne,W=D("Folder"),K=D("Paperclip"),Q=D("EditPen"),X=se,Y=re;return P(),T(B,null,[t(M,{width:"80vw",modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=s=>y.value=s),"align-center":"align-center",fullscreen:"fullscreen","close-on-click-modal":!1,onClose:J},{header:o(()=>[t(i,{align:"middle",style:{"margin-bottom":"10px"}},{default:o(()=>[e[10]||(e[10]=m("span",{id:"title",style:{"font-weight":"bolder","font-size":"24px",color:"#666666"}},"Editor",-1)),t(n,{style:{width:"30%","margin-left":"15px"},modelValue:a.value.topic,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.topic=s),clearable:"",min:"1"},{prepend:o(()=>e[7]||(e[7]=[c("\u6807\u9898")])),_:1},8,["modelValue"]),t(n,{style:{width:"30%","margin-left":"15px"},modelValue:a.value.intro,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.intro=s),clearable:"","show-word-limit":""},{prepend:o(()=>e[8]||(e[8]=[c("\u7B80\u4ECB")])),_:1},8,["modelValue"]),t(n,{style:{width:"20%","margin-left":"15px"},modelValue:a.value.assort,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.assort=s),clearable:"",maxlength:"8","show-word-limit":""},{prepend:o(()=>e[9]||(e[9]=[c("\u5206\u7C7B")])),_:1},8,["modelValue"])]),_:1})]),footer:o(()=>[m("span",ge,[t(q,{size:"large",type:"danger",onClick:j},{default:o(()=>e[11]||(e[11]=[c(" \u5220\u9664 ")])),_:1}),t(q,{size:"large",type:"primary",onClick:H},{default:o(()=>e[12]||(e[12]=[c(" \u6295\u9001 ")])),_:1})])]),default:o(()=>[t(i,{justify:"space-evenly",style:{"margin-bottom":"10px"}}),t(O,{modelValue:a.value.content,"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.content=s),height:"77vh",onSave:U},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(i,{style:{height:"24px"},justify:"space-between",align:"middle"},{default:o(()=>[t(u,{span:6},{default:o(()=>[m("span",{class:"back",onClick:z}," \u2B05 \u85CF\u5178\u9601 ")]),_:1}),t(u,{span:10,style:{"text-align":"center"}},{default:o(()=>[m("span",ve,h(k(r).$userInfo.value.username)+"\u7684\u8349\u7A3F\u7BB1",1)]),_:1}),t(u,{span:6,style:{"text-align":"right"}})]),_:1}),t(L,{id:"divider","border-style":"dashed","content-position":"left"}),(P(!0),T(B,null,fe(S.value,s=>(P(),T("div",null,[t(i,{onClick:be=>F(s.id),style:{cursor:"pointer"}},{default:o(()=>[t(u,{span:24,style:{"margin-bottom":"20px"}},{default:o(()=>[t(X,{class:"articleCard"},{default:o(()=>[t(i,null,{default:o(()=>[t(u,{span:10,class:"articleImgBox"},{default:o(()=>[m("img",{src:G(s.topic),class:"articleImg"},null,8,_e)]),_:2},1024),t(u,{span:14,style:{padding:"10px 15px 15px 15px"}},{default:o(()=>[m("div",he,[m("span",ye,h(s.intro),1),m("span",we,[t(i,null,{default:o(()=>[t(u,{span:12},{default:o(()=>[t(E,{style:{top:"2px"}},{default:o(()=>[t(R)]),_:1}),c(" \u4F5C\u8005\uFF1A"+h(s.author),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(E,{style:{top:"2px"}},{default:o(()=>[t(W)]),_:1}),c(" \u5206\u7C7B\uFF1A"+h(s.assort),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(E,{style:{top:"2px"}},{default:o(()=>[t(K)]),_:1}),c(" \u5EFA\u7ACB\u4E8E\uFF1A"+h(k(A)(new Date(s.createDate))),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(E,{style:{top:"2px"}},{default:o(()=>[t(Q)]),_:1}),c(" \u4FEE\u6539\u4E8E\uFF1A"+h(k(A)(new Date(s.changeDate))),1)]),_:2},1024)]),_:2},1024)])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),256)),t(i,{style:{width:"100%"},class:"pagination",align:"middle",justify:"center"},{default:o(()=>[t(Y,{style:{transform:"scale(1.2,1.2)"},"hide-on-single-page":!0,"page-size":5,"current-page":V.value,"onUpdate:currentPage":e[5]||(e[5]=s=>V.value=s),layout:"prev, pager, next",total:f.value,onCurrentChange:e[6]||(e[6]=s=>C(V.value))},null,8,["current-page","total"])]),_:1})],64)}}},Je=pe(De,[["__scopeId","data-v-159bcc34"]]);export{Je as default};
