import{f as ee,g as te,h as oe,i as ae,m as le,j as ne,r as se,l as re,s as ie,e as ue,d as _}from"./element-plus.7d590150.js";import{u as pe}from"./vue-router.acfefc2e.js";import{_ as de,u as ce,r as w}from"./index.dae0fc6c.js";import{D as U}from"./Date.43b474cf.js";import{h as f,a0 as me,aa as y,o as x,c as b,L as t,J as o,G as F,ac as fe,a as d,a2 as p,O as c,u as C,F as O,a7 as ge}from"./@vue.2fe4fb4f.js";import"./@element-plus.6dbc46d1.js";import"./@vueuse.1809dbd0.js";import"./lodash-es.292de2a1.js";import"./@popperjs.36402333.js";import"./@ctrl.b082b0c1.js";import"./js-md5.959ac667.js";import"./@babel.53fad141.js";import"./@kangc.4df2a972.js";import"./vue.02683aef.js";import"./@vuepress.0f7d6c54.js";import"./highlight.js.a44cb2e8.js";import"./codemirror.9d7a24b7.js";import"./sakana-widget.26843129.js";const ve={class:"dialog-footer"},he={style:{"font-weight":"bolder",color:"#666666","font-size":"x-large"}},_e=["src"],we={key:0,style:{top:"0",color:"#666666","font-weight":"bolder","font-size":"24px","word-break":"break-all",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",margin:"0",height:"30px","line-height":"30px","word-wrap":"break-word"}},ye={key:1,style:{top:"0",color:"#666666","font-weight":"bolder","font-size":"24px","word-break":"break-all",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",margin:"0",height:"30px","line-height":"30px","word-wrap":"break-word"}},xe={style:{height:"150px",width:"auto"}},be={class:"introCard"},ke={style:{color:"#777777","font-size":"small",bottom:"10px",position:"absolute",width:"55%"}},k="https://server.asgardion.space",Ee={__name:"AuthorView",setup($e){const E=f(!0),v=f(!1),r=ce(),m=pe(),h=f(),P=f([]),$=f([]),D=f(parseInt(m.params.page||1));let z="https://source.unsplash.com/random/900x600/?desktop,wallparper";const l=f({id:"",authorUuid:r.$userInfo.value.id,topic:"",content:"",intro:"",assort:"",author:r.$userInfo.value.username,createDate:new Date,changeDate:new Date,tag:"",like:[],weight:0}),g=new Headers;g.append("Content-Type","application/json");async function S(n){let e={method:"GET",headers:g,redirect:"follow"};await fetch(`${k}/article/${n}`,e).then(s=>s.json()).then(s=>{origin=s,l.value=s}),v.value=!0,E.value=!0}function A(n){P.value=ge($.value).slice(n*5-5,n*5),n!==1?w.push({name:"AuthorPage",params:{page:n}}):w.push({name:"Author"});let e;cancelAnimationFrame(e),e=requestAnimationFrame(function s(){let i=document.body.scrollTop||document.documentElement.scrollTop;i>0?(scrollTo(0,i-25),e=requestAnimationFrame(s)):cancelAnimationFrame(e)})}async function I(){let n={method:"GET",headers:g,redirect:"follow"};await fetch(`${k}/article/`,n).then(e=>e.json()).then(e=>{$.value=[];for(let s in e)e[s].authorUuid===r.$userInfo.value.id&&$.value.push(e[s]);h.value=$.value.length}),typeof m.params.page<"u"?A(m.params.page):A(1)}function j(){let n={method:"PATCH",headers:g,redirect:"follow"};n.body=JSON.stringify(r.$userInfo.value),fetch(`${k}/users/${r.$userInfo.value.id}`,n)}async function q(){let n={method:"DELETE",headers:g,redirect:"follow"};const e=l.value;n.body=JSON.stringify(e),await fetch(`${k}/article/${l.value.id}`,n).then(()=>{_({message:"\u7A3F\u7EB8\u5DF2\u88AB\u6298\u6210\u7EB8\u98DE\u673A\uFF5E",type:"success"}),r.$reload.value=!r.$reload.value,r.$reloadHot.value=!r.$reloadHot.value,r.$userInfo.value.articles--,E.value=!1,v.value=!1,h.value--,j()}).catch(s=>_({message:s,type:"error"})),h.value%5===0&&m.params.page>2&&await w.push({name:m.name,params:{page:m.params.page-1}}),h.value%5===0&&m.params.page===2&&await w.push({name:"Author"}),await I()}async function T(){if(l.value.topic===""){_({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}l.value.assort===""&&(l.value.assort="Default"),l.value.intro===""&&(l.value.intro=l.value.content.substring(0,155));let n={method:"PATCH",headers:g,redirect:"follow"};const e=l.value;e.changeDate=new Date,n.body=JSON.stringify(e),await fetch(`${k}/article/${l.value.id}`,n).then(()=>{_({message:"\u5DF2\u4FDD\u5B58\u4FEE\u6539\uFF01",type:"success"})}).catch(s=>_({message:s,type:"error"})),await I()}function N(){T(),E.value=!1,v.value=!1}function H(){(l.value.content!==""||l.value.topic!=="")&&E.value&&ue.confirm("\u5185\u5BB9\u672A\u4FDD\u5B58\uFF0C"+r.$userInfo.value.username+"\u771F\u7684\u8981\u8D70\u5417\uFF1F","Warning",{confirmButtonText:"\u72E0\u5FC3\u79BB\u5F00",cancelButtonText:"\u4FDD\u5B58\u5E76\u79BB\u5F00",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).catch(()=>{T()})}function G(){w.push({name:"Main"})}me(()=>{I()});function M(n){return z+","+n+")"}return(n,e)=>{const s=ee,i=te,J=y("v-md-editor"),B=oe,L=ae,u=le,R=ne,W=y("User"),V=se,K=y("Folder"),Q=y("Paperclip"),X=y("EditPen"),Y=re,Z=ie;return x(),b(F,null,[t(L,{width:"80vw",modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),"align-center":"align-center",fullscreen:"fullscreen","close-on-click-modal":!1,onClose:H},{header:o(()=>[t(i,{align:"middle",style:{"margin-bottom":"10px"}},{default:o(()=>[e[10]||(e[10]=d("span",{id:"title",style:{"font-weight":"bolder","font-size":"24px",color:"#666666"}},"Editor",-1)),t(s,{style:{width:"30%","margin-left":"15px"},modelValue:l.value.topic,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.topic=a),clearable:"",min:"1"},{prepend:o(()=>e[7]||(e[7]=[p("\u6807\u9898")])),_:1},8,["modelValue"]),t(s,{style:{width:"30%","margin-left":"15px"},modelValue:l.value.intro,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.intro=a),clearable:"","show-word-limit":""},{prepend:o(()=>e[8]||(e[8]=[p("\u7B80\u4ECB")])),_:1},8,["modelValue"]),t(s,{style:{width:"20%","margin-left":"15px"},modelValue:l.value.assort,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.assort=a),clearable:"",maxlength:"8","show-word-limit":""},{prepend:o(()=>e[9]||(e[9]=[p("\u5206\u7C7B")])),_:1},8,["modelValue"])]),_:1})]),footer:o(()=>[d("span",ve,[t(B,{size:"large",type:"danger",onClick:q},{default:o(()=>e[11]||(e[11]=[p(" \u5220\u9664 ")])),_:1}),t(B,{size:"large",type:"primary",onClick:N},{default:o(()=>e[12]||(e[12]=[p(" \u4FEE\u6539 ")])),_:1})])]),default:o(()=>[t(i,{justify:"space-evenly",style:{"margin-bottom":"10px"}}),t(J,{modelValue:l.value.content,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.content=a),height:"77vh",onSave:T},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(i,{style:{height:"24px"},justify:"space-between",align:"middle"},{default:o(()=>[t(u,{span:6},{default:o(()=>[d("span",{class:"back",onClick:G}," \u2B05 \u85CF\u5178\u9601 ")]),_:1}),t(u,{span:10,style:{"text-align":"center"}},{default:o(()=>[d("span",he,c(C(r).$userInfo.value.username)+"\u5DF2\u6295\u9001"+c(C(r).$userInfo.value.articles)+"\u7BC7",1)]),_:1}),t(u,{span:6,style:{"text-align":"right"}})]),_:1}),t(R,{id:"divider","border-style":"dashed","content-position":"left"}),(x(!0),b(F,null,fe(P.value,a=>(x(),b("div",null,[t(i,{onClick:Ve=>S(a.id),style:{cursor:"pointer"}},{default:o(()=>[t(u,{span:24,style:{"margin-bottom":"20px"}},{default:o(()=>[t(Y,{class:"articleCard"},{default:o(()=>[t(i,null,{default:o(()=>[t(u,{span:10,class:"articleImgBox"},{default:o(()=>[d("img",{src:M(a.topic),class:"articleImg"},null,8,_e)]),_:2},1024),t(u,{span:14,style:{padding:"10px 15px 15px 15px"}},{default:o(()=>[a.weight===0?(x(),b("h1",we,c(a.topic),1)):O("",!0),a.weight!==0?(x(),b("h1",ye,[e[13]||(e[13]=d("span",{style:{color:"#F46B6B"}},"\u300C\u7F6E\u9876\u300D",-1)),p(c(a.topic),1)])):O("",!0),d("div",xe,[d("span",be,c(a.intro),1),d("span",ke,[t(i,null,{default:o(()=>[t(u,{span:12},{default:o(()=>[t(V,{style:{top:"2px"}},{default:o(()=>[t(W)]),_:1}),p(" \u4F5C\u8005\uFF1A"+c(a.author),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(V,{style:{top:"2px"}},{default:o(()=>[t(K)]),_:1}),p(" \u5206\u7C7B\uFF1A"+c(a.assort),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(V,{style:{top:"2px"}},{default:o(()=>[t(Q)]),_:1}),p(" \u5EFA\u7ACB\u4E8E\uFF1A"+c(C(U)(new Date(a.createDate))),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(V,{style:{top:"2px"}},{default:o(()=>[t(X)]),_:1}),p(" \u4FEE\u6539\u4E8E\uFF1A"+c(C(U)(new Date(a.changeDate))),1)]),_:2},1024)]),_:2},1024)])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),256)),t(i,{style:{width:"100%"},class:"pagination",align:"middle",justify:"center"},{default:o(()=>[t(Z,{style:{transform:"scale(1.2,1.2)"},"hide-on-single-page":!0,"page-size":5,"current-page":D.value,"onUpdate:currentPage":e[5]||(e[5]=a=>D.value=a),layout:"prev, pager, next",total:h.value,onCurrentChange:e[6]||(e[6]=a=>A(D.value))},null,8,["current-page","total"])]),_:1})],64)}}},Je=de(Ee,[["__scopeId","data-v-1e23e19a"]]);export{Je as default};
